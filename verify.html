<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Certificate Verification</title>
  <style>
    :root{
      --bg:#f7fafc;
      --card:#ffffff;
      --accent:#0b74de;
      --muted:#6b7280;
      --success:#059669;
      --danger:#dc2626;
      --shadow: 0 6px 18px rgba(15,23,42,0.08);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;margin:0;background:var(--bg);color:#0f172a;}
    .wrap {
      max-width:980px;
      margin:28px auto;
      padding:20px;
    }

    .card {
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
    }

    header{
      display:flex;
      gap:16px;
      align-items:center;
      margin-bottom:14px;
    }

    .logo {
      display:inline-grid;
      place-items:center;
      width:56px;height:56px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),#5db2ff);
      color:#fff;font-weight:700;
      box-shadow:0 6px 14px rgba(11,116,222,0.18);
    }

    h1{font-size:18px;margin:0 0 6px 0;}
    .subtitle{color:var(--muted);font-size:13px;margin:0;}

    .status {
      display:flex;
      gap:12px;
      align-items:center;
      margin:14px 0;
      flex-wrap:wrap;
    }

    .badge {
      padding:8px 12px;border-radius:999px;font-weight:600;font-size:14px;
      display:inline-flex;align-items:center;gap:8px;
    }
    .badge.valid{background:rgba(5,150,105,0.12);color:var(--success);}
    .badge.invalid{background:rgba(220,38,38,0.08);color:var(--danger);}

    .controls {display:flex;gap:10px;flex-wrap:wrap;}
    button, a.btn {
      border:0;padding:10px 14px;border-radius:10px;font-weight:600;
      cursor:pointer;background:var(--accent);color:#fff;text-decoration:none;
      box-shadow: 0 6px 10px rgba(11,116,222,0.12);
    }
    button.ghost {background:transparent;color:var(--accent);box-shadow:none;border:1px solid rgba(11,116,222,0.12);}

    .meta {margin-top:12px;color:var(--muted);font-size:13px;}

    .viewer {
      margin-top:18px;height:60vh;border-radius:10px;overflow:hidden;border:1px solid #e6eefc;
      background:linear-gradient(180deg,#fff, #fbfdff);
    }
    iframe {
      width:100%;height:100%;border:0;
    }

    .footer {
      margin-top:12px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;
    }

    @media (max-width:640px){
      .viewer {height:48vh;}
      .controls {width:100%;}
      header {gap:12px;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <header>
        <div class="logo">CV</div>
        <div>
          <h1 id="certTitle">Certificate Verification</h1>
          <p class="subtitle" id="certSubtitle">Checking certificate status...</p>
        </div>
      </header>

      <div class="status" id="statusRow">
        <!-- status badge injected by JS -->
        <div id="badgePlace"></div>

        <div class="controls" id="controls">
          <a id="viewBtn" class="btn" target="_blank" rel="noopener">Open PDF</a>
          <a id="downloadBtn" class="btn ghost" download>Download</a>
          <button id="copyBtn" class="ghost">Copy link</button>
        </div>
      </div>

      <div class="meta" id="metaLine">File: <span id="fileName">—</span></div>

      <div class="viewer" id="viewer">
        <iframe id="pdfFrame" title="Certificate preview"></iframe>
      </div>

      <div class="footer">
        <div id="verifyNote">This certificate is authentic if you scanned the official QR/link provided by the issuer.</div>
        <div id="lastCheck" style="color:var(--muted)">Checked: —</div>
      </div>
    </div>
  </div>

<script>
/*
 Usage:
  verify.html?file=Akash_Subhash_Dalvi_Certificate.pdf&name=Akash%20Subhash%20Dalvi
  or absolute:
  verify.html?file=https://kumardalvi.github.io/certificates-verification/Akash_Subhash_Dalvi_Certificate.pdf&name=...
*/

(function(){
  const qs = new URLSearchParams(location.search);
  const fileParam = qs.get('file') || ''; // required for actual usage
  const nameParam = qs.get('name') || '';

  // If user passed relative filename, build absolute URL relative to current folder
  const base = location.origin + location.pathname.replace(/\/[^/]*$/, '/'); // folder of current HTML
  const pdfUrl = isAbsoluteUrl(fileParam) ? fileParam : (fileParam ? base + encodeURI(fileParam) : '');

  const certTitleEl = document.getElementById('certTitle');
  const certSubtitleEl = document.getElementById('certSubtitle');
  const badgePlace = document.getElementById('badgePlace');
  const fileNameEl = document.getElementById('fileName');
  const pdfFrame = document.getElementById('pdfFrame');
  const viewBtn = document.getElementById('viewBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const copyBtn = document.getElementById('copyBtn');
  const lastCheck = document.getElementById('lastCheck');

  // derive display name
  const displayName = nameParam || deriveNameFromFile(fileParam) || 'Unnamed Certificate';
  document.title = displayName + ' — Certificate';
  certTitleEl.textContent = displayName;
  certSubtitleEl.textContent = 'Verified by issuer';

  fileNameEl.textContent = fileParam || 'No file provided';

  if(!pdfUrl){
    showInvalid('No certificate file specified in URL. Please provide ?file=... ');
    return;
  }

  // set UI links
  viewBtn.href = pdfUrl;
  downloadBtn.href = pdfUrl;
  downloadBtn.setAttribute('download', fileParam.split('/').pop());

  pdfFrame.src = pdfUrl;

  // perform a HEAD request to check existence
  (async function check(){
    const started = new Date();
    try {
      const res = await fetch(pdfUrl, { method: 'HEAD' });
      const ok = res && (res.ok || res.status === 200);
      const statusText = res.status ? (res.status + ' ' + res.statusText) : '';
      const checkedAt = new Date().toLocaleString();
      lastCheck.textContent = 'Checked: ' + checkedAt;

      if(ok) {
        showValid('This certificate is valid.');
      } else {
        // some hosts disallow HEAD; try GET for fallback (small request)
        try {
          const res2 = await fetch(pdfUrl, { method: 'GET', headers: { 'range': 'bytes=0-0' }});
          if(res2 && (res2.ok || res2.status === 206 || res2.status === 200)) {
            showValid('This certificate is valid.');
          } else {
            showInvalid('Certificate file not accessible (' + statusText + ').');
          }
        } catch(err2){
          showInvalid('Certificate file not accessible (' + statusText + ').');
        }
      }
    } catch (err) {
      // network error or CORS; try GET as fallback
      try {
        const res2 = await fetch(pdfUrl, { method: 'GET', headers: { 'range': 'bytes=0-0' }});
        if(res2 && (res2.ok || res2.status === 206 || res2.status === 200)) {
          showValid('This certificate is valid.');
        } else {
          showInvalid('Certificate file not accessible. (' + (res2 ? res2.status : 'unknown') + ')');
        }
      } catch (err2) {
        showInvalid('Unable to verify certificate due to network/CORS. It may still be valid — try opening the PDF.');
      }
    }
  })();

  // Button handlers
  copyBtn.addEventListener('click', async ()=>{
    try {
      await navigator.clipboard.writeText(pdfUrl);
      copyBtn.textCont
